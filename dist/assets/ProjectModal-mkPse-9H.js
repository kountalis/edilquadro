import{j as t,A as $,m as p}from"./ui-vendor-CglP4wyi.js";import{r as o,d as S}from"./router-vendor-DhjEXmDM.js";import{g as L,h as C,F}from"./index-DLeojmDS.js";import{L as A}from"./LazyImage-DZPinvUv.js";const D=({project:a,isOpen:c,onClose:g})=>{const[l,d]=o.useState(0),[w,y]=o.useState(0),[v,k]=o.useState(0),[N,m]=o.useState(!0),[b,u]=o.useState(!1);if(o.useEffect(()=>{d(0),m(!0),a&&a.images&&a.images.forEach((e,s)=>{const r=new Image;r.src=e,r.onload=()=>{},r.onerror=()=>{console.error(`Failed to preload image ${s+1}: ${e}`)}})},[a]),o.useEffect(()=>{if(a&&a.images){const e=a.images.length-1;(l>e||l<0)&&d(0)}},[a,l]),o.useEffect(()=>{const e=s=>{if(c)switch(s.key){case"ArrowLeft":f();break;case"ArrowRight":h();break;case"Escape":g();break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,l,a]),o.useEffect(()=>(c?(document.body.style.overflow="hidden",document.body.style.paddingRight="15px"):(document.body.style.overflow="auto",document.body.style.paddingRight="0"),()=>{document.body.style.overflow="auto",document.body.style.paddingRight="0"}),[c]),!a||!c)return null;const n=a.images||[a.image];if(!n||n.length===0)return null;const x=n[l];if(!x)return d(0),null;const h=()=>{b||(u(!0),m(!0),d(e=>{const s=e===n.length-1?0:e+1,r=n[s];if(r){const i=new Image;i.src=r,i.onload=()=>{},i.onerror=()=>{console.error(`Failed to preload image: ${r}`)}}return s}))},f=()=>{b||(u(!0),m(!0),d(e=>{const s=e===0?n.length-1:e-1,r=n[s];if(r){const i=new Image;i.src=r,i.onload=()=>{},i.onerror=()=>{console.error(`Failed to preload image: ${r}`)}}return s}))},I=e=>{y(e.targetTouches[0].clientX)},j=e=>{k(e.targetTouches[0].clientX)},E=()=>{const e=w-v;e>100&&h(),e<-100&&f()},T=e=>e&&e.match(/\.(jpg|jpeg|png)$/i)?e.replace(/\.(jpg|jpeg|png)$/i,".webp"):null;return S.createPortal(t.jsx($,{children:c&&t.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm",onClick:g,children:t.jsxs(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",damping:25},className:"relative w-full max-w-5xl bg-gray-900 rounded-xl overflow-hidden shadow-2xl",onClick:e=>e.stopPropagation(),children:[t.jsx("button",{onClick:g,className:"absolute top-4 right-4 z-10 p-2 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors","aria-label":"Chiudi",children:t.jsx(L,{className:"w-5 h-5"})}),t.jsxs("div",{className:"relative h-[70vh] w-full bg-black",onTouchStart:I,onTouchMove:j,onTouchEnd:E,children:[N&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"w-12 h-12 border-4 border-green-500/30 border-t-green-500 rounded-full animate-spin"})}),t.jsx("img",{src:x,alt:`${a.title} - Immagine ${l+1}`,className:"modal-image-contain",onLoad:()=>{m(!1),u(!1)},onError:()=>{m(!1),u(!1)},loading:"eager",fetchpriority:"high"}),n.length>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),f()},className:"absolute left-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors","aria-label":"Immagine precedente",children:t.jsx(C,{className:"w-5 h-5"})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),h()},className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors","aria-label":"Immagine successiva",children:t.jsx(F,{className:"w-5 h-5"})})]}),n.length>1&&t.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-3 py-1 rounded-full bg-black/70 text-white text-sm",children:[l+1," / ",n.length]})]}),t.jsxs("div",{className:"p-6 bg-gradient-to-t from-gray-900 to-gray-800",children:[t.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:a.title}),t.jsx("p",{className:"text-green-400 mb-4",children:a.category.charAt(0).toUpperCase()+a.category.slice(1)}),a.description&&t.jsx("p",{className:"text-gray-300",children:a.description}),n.length>1&&t.jsx("div",{className:"mt-4 overflow-x-auto pb-2",children:t.jsx("div",{className:"flex space-x-2",children:n.map((e,s)=>t.jsx("button",{onClick:()=>{d(s),m(!0)},className:`flex-shrink-0 w-16 h-16 rounded-md overflow-hidden border-2 transition-all ${l===s?"border-green-500 scale-110":"border-transparent opacity-70"}`,"aria-label":`Vai all'immagine ${s+1}`,children:t.jsx(A,{src:e||n[0],webpSrc:T(e||n[0]),alt:`Miniatura ${s+1}`,className:"w-full h-full",imageClassName:"object-cover object-center",width:"64",height:"64"})},s))})})]})]})})}),typeof window<"u"?document.body:null)};export{D as P};
